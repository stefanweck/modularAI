!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=function(){this.events={}};d.prototype={on:function(a,b,c){this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push([b,c])},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.events[a];if(void 0!==c)for(var d=0;d<c.length;d++){var e,f=c[d][0];e=void 0===c[d][1]?this:c[d][1],f.apply(e,b)}}},b.exports=d},{}],2:[function(a,b,c){"use strict";var d=a("../entity/group.js"),e=a("../factories/robotfactory.js"),f=a("../world/settings.js"),g=a("../world/world.js"),h=function(a){this.isInitialized=!1,this.entities=null,this.world=null,this.settings=null,this.initialize()};h.prototype={initialize:function(){if(!this.isInitialized){this.entities=new d,this.world=new g,this.settings=new f(this);var a=e.defaultRobot();this.entities.addEntity(a),this.world.scene.add(a.mesh),this.update(),this.isInitialized=!0}},update:function(){requestAnimationFrame(this.update.bind(this));for(var a=this.entities.getEntities(),b=0;b<a.length;b++)a[b].run();this.world.update()}},b.exports=h},{"../entity/group.js":5,"../factories/robotfactory.js":6,"../world/settings.js":14,"../world/world.js":15}],3:[function(a,b,c){"use strict";var d={randomNumber:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},randomNumberSteps:function(a,b,c){return a+c*Math.floor(Math.random()*(b-a)/c)},averageArray:function(a){for(var b=0,c=0;c<a.length;c++)b+=parseInt(a[c],10);return b/a.length}};b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("../systems/task.js"),e=a("../systems/measure.js"),f=function(a){this.name=a,this.systems={},this.mesh=null,this.initialize()};f.prototype={initialize:function(){this.systems.task=new d,this.systems.measure=new e(this),this.systems.task.events.on("finished",this.finishedTask.bind(this),this),this.createMesh()},createMesh:function(){var a=new THREE.BoxGeometry(20,20,20);this.mesh=new THREE.Mesh(a,new THREE.MeshLambertMaterial({color:16777215*Math.random()})),this.mesh.position.set(0,0,0),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0},run:function(){for(var a in this.systems)this.systems.hasOwnProperty(a)&&this.systems[a].run()},finishedTask:function(){var a=this.systems.measure.calculateAverageAudio();this.systems.task.currentTask.measurements.audio.push(a)}},b.exports=f},{"../systems/measure.js":8,"../systems/task.js":9}],5:[function(a,b,c){"use strict";var d=a("./entity.js"),e=function(){this.entities=[]};e.prototype={addEntity:function(a){!a instanceof d||this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);-1!==b&&this.entities.splice(b,1)},getEntities:function(){return this.entities}},b.exports=e},{"./entity.js":4}],6:[function(a,b,c){"use strict";var d=a("../entity/entity.js"),e=a("../tasks/vacuum.js"),f=a("../tasks/mop.js"),g={defaultRobot:function(){var a=new d("Default");return a.systems.task.addTask(new e(a)),a.systems.task.addTask(new f(a)),a}};b.exports=g},{"../entity/entity.js":4,"../tasks/mop.js":11,"../tasks/vacuum.js":13}],7:[function(a,b,c){"use strict";var d=a("./core/system.js"),e=function(){{var a={};new d(a)}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.addEventListener("load",e),b.exports=e},{"./core/system.js":2}],8:[function(a,b,c){"use strict";var d=a("../core/utils.js"),e=function(a){this.entity=a,this.audioLevels=[]};e.prototype={run:function(){this.measureAudio()},measureAudio:function(){var a=0;switch(this.entity.systems.task.currentTask.name){case"Vacuum":a+=globalSettings.vacuumNoise;break;case"Mop":a+=globalSettings.mopNoise;break;default:a+=globalSettings.globalNoise}this.audioLevels.push(a)},calculateAverageAudio:function(){var a=d.averageArray(this.audioLevels);return this.audioLevels=[],a}},b.exports=e},{"../core/utils.js":3}],9:[function(a,b,c){"use strict";var d=a("../core/event.js"),e=a("../tasks/idle.js"),f=a("../core/utils.js"),g=function(){this.events=new d,this.tasks=[],this.currentTask=null};g.prototype={run:function(){if("busy"!==this.currentTask.state){if(this.events.trigger("finished"),this.currentTask.measurements.audio.length>=5){var a=f.averageArray(this.currentTask.measurements.audio);this.currentTask.isLoud=a>40?!0:!1,this.currentTask.measurements.audio=[],this.currentTask.measurements.audio.push(a)}var b=this.getPossibleTasks();this.currentTask=this.pickTask(b),this.currentTask.run()}},getTask:function(a){return this.tasks[a]},addTask:function(a){this.tasks.push(a),null===this.currentTask&&(this.currentTask=a,this.currentTask.run())},removeTask:function(a){this.task.splice(a,1)},totalTasks:function(){return this.tasks.length()},getPossibleTasks:function(){for(var a=[],b=0;b<this.tasks.length;b++)this.tasks[b].isLoud&&!(globalSettings.currentTime>=9&&globalSettings.currentTime<=21)&&globalSettings.globalNoise<this.tasks[b].measurements.audio[0]||a.push(this.tasks[b]);return a},pickTask:function(a){if(0===a.length)return new e;for(var b=a[0],c=0;c<a.length;c++){if(null===a[c].lastFinished)return a[c];a[c].lastFinished<b.lastFinished&&(b=a[c])}return b}},b.exports=g},{"../core/event.js":1,"../core/utils.js":3,"../tasks/idle.js":10}],10:[function(a,b,c){"use strict";var d=a("./task.js"),e=function(a){d.call(this,a),this.name="Idle"};e.prototype=Object.create(d.prototype,{run:{value:function(){this.start(),console.log("I'm idling now"),setTimeout(this.finish.bind(this),3e3)}}}),b.exports=e},{"./task.js":12}],11:[function(a,b,c){"use strict";var d=a("./task.js"),e=function(a){d.call(this,a),this.name="Mop"};e.prototype=Object.create(d.prototype,{run:{value:function(){this.start(),console.log("I'm mopping the floor now"),TweenMax.to(this.entity.mesh.rotation,3,{y:this.entity.mesh.rotation.y+10,onComplete:this.finish.bind(this)})}}}),b.exports=e},{"./task.js":12}],12:[function(a,b,c){"use strict";var d=function(a){this.name="Base Task",this.state="planned",this.isLoud=null,this.lastFinished=null,this.entity=a,this.measurements={audio:[]}};d.prototype={run:function(){},start:function(){this.state="busy"},finish:function(){this.state="done",this.lastFinished=Date.now()}},b.exports=d},{}],13:[function(a,b,c){"use strict";var d=a("./task.js"),e=a("../core/utils.js"),f=function(a){d.call(this,a),this.name="Vacuum"};f.prototype=Object.create(d.prototype,{run:{value:function(){this.start(),console.log("I'm vacuuming now");var a={x:e.randomNumberSteps(-100,100,20),z:e.randomNumberSteps(-100,100,20)},b={x:Math.abs(a.x-this.entity.mesh.position.x),z:Math.abs(a.z-this.entity.mesh.position.z)},c=b.x+b.z,d=c/35;TweenMax.to(this.entity.mesh.position,d,{x:a.x,z:a.z,onComplete:this.finish.bind(this)})}}}),b.exports=f},{"../core/utils.js":3,"./task.js":12}],14:[function(a,b,c){"use strict";var d=function(a){this.values=null,this.gui=null,this.system=a,this.initialize()};d.prototype={initialize:function(a){var b=new Date,c=function(){this.globalNoise=10,this.vacuumNoise=70,this.mopNoise=0,this.currentTime=b.getHours()};this.values=new c,globalSettings=this.values,this.gui=new dat.GUI;var d=this.gui.addFolder("Noise");d.add(this.values,"globalNoise",0,100),d.add(this.values,"vacuumNoise",0,100),d.add(this.values,"mopNoise",0,100);var e=this.gui.addFolder("Time");e.add(this.values,"currentTime",1,24)}},b.exports=d},{}],15:[function(a,b,c){"use strict";var d=function(){this.container=null,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.initialize()};d.prototype={initialize:function(){this.container=document.getElementById("container"),this.initializeCamera(),this.initializeControls(),this.initializeStage(),this.initializeRenderer(),window.addEventListener("resize",this.onWindowResize.bind(this),!1)},initializeCamera:function(){this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.set(120,140,150)},initializeControls:function(){this.controls=new THREE.TrackballControls(this.camera,this.container),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1.2,this.controls.panSpeed=1,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!0,this.controls.dynamicDampingFactor=.3},initializeStage:function(){this.scene=new THREE.Scene;var a=new THREE.HemisphereLight(16777215,16777215,.6);a.color.setHSL(.6,1,.6),a.groundColor.setHSL(.095,1,.75),a.position.set(0,500,0),this.scene.add(a);var b=new THREE.DirectionalLight(16777215,1);b.color.setHSL(.1,1,.95),b.position.set(-1,1,4),b.position.multiplyScalar(50),this.scene.add(b);var c=500;b.castShadow=!0,b.shadowMapWidth=2048,b.shadowMapHeight=2048,b.shadowCameraLeft=-c,b.shadowCameraRight=c,b.shadowCameraTop=c,b.shadowCameraBottom=-c,b.shadowCameraFar=3500,b.shadowBias=-1e-4,b.shadowDarkness=.35;for(var d=500,e=20,f=new THREE.Geometry,g=new THREE.LineBasicMaterial({color:"white"}),h=-d;d>=h;h+=e)f.vertices.push(new THREE.Vector3(-d,-.04,h)),f.vertices.push(new THREE.Vector3(d,-.04,h)),f.vertices.push(new THREE.Vector3(h,-.04,-d)),f.vertices.push(new THREE.Vector3(h,-.04,d));var i=new THREE.Line(f,g,THREE.LinePieces);i.position.set(-10,-10,10),this.scene.add(i)},initializeRenderer:function(){this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(15790320),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.sortObjects=!1,this.renderer.shadowMapEnabled=!0,this.renderer.shadowMapType=THREE.PCFShadowMap,this.container.appendChild(this.renderer.domElement)},onWindowResize:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},update:function(){this.controls.update(),this.renderer.render(this.scene,this.camera)}},b.exports=d},{}]},{},[7]);